---
title: "[MP] LAB1-2: 코드작성 PART2"
date: 2022-03-19 23:00:00 +0800
categories: [STUDY, LAB]
tags: [matlab, machine_perception, acoustic_signal]     # TAG names should always be lowercase
---

본 파트에서는 오디오를 재생함과 동시에 현재 재생되는 부분의 Time & Frequency Domain 파형을 실시간으로 보여주는 기능을 구현합니다.
> 이 기능을 구현하기까지 얼마나 많은 시도가 있었는지 모른다... 처음에는 sound(audio,fs)함수를 통해 오디오를 재생하고 loop를 사용해 plot; drawnow; 구문을 반복해서 실행시켜 그래프를 주기적으로 업데이트해주는 방법을 사용했으나 
> 재생시간과 반복문이 돌아가는 시간이 맞지 않아 포기했다. 반복문안의 코드가 너무 빨리 실행되어 그런가 해서 wait함수도 사용해보고 별 짓을 다 했지만 실시간으로 파형을 보여주는 기능을 만들지 못했다.
> 그래서 생각해낸 것이 timer을 사용하는 것이다... timer은 시간을 세면서 일정 함수나 동작을 주기적으로 실행시킬 수 있다. timerFcn이라는 속성에 원하는 함수를 지정시켜주고 start(timer)만 해주면 완성이다.
> audioplayer이라는 객체에도 비슷한 기능이 있으나 잘 작동되지 않아 어쩔 수 없이 timer을 사용했다. 이하 본문에서는 어떻게 timer을 사용하는지 timerFcn에는 어떤 함수를 사용했는지에 대해 다룬다.
 
## 코드작성 PART2
+ 전역변수 사용  
```matlab
global audio;
global fs;
```
위의 코드를 pushbutton 1과 2에 해당하는 함수 제일 앞부분에 넣으면 됩니다. 오디오 파일을 다시 가져와 읽지 않고 첫번째 버튼에서 audioread 함수를 통해 얻은 오디오 신호 audio 와 샘플 레이트 fs를 전역변수로 정의하여 두번재 버튼에서도 사용할 수 있게 합니다.
+ __audioplayer__ 객체
```matlab
player = audioplayer(audio,fs);
```
  - [[audioplayer에 대한 MATLAB 공식 문서]](https://www.mathworks.com/help/releases/R2021a/matlab/ref/audioplayer.html "MATLAB 문서")
  > "audioplayer 객체를 사용하여 오디오 데이터를 재생합니다. 이 객체는 재생 중에 추가적인 유연성을 제공하는 속성을 포함합니다. 예를 들어, audioplayer 객체 함수를 사용하여 재생을 일시 중지하거나, 재개하거나, 콜백을 정의할 수 있습니다."
  - 이 객체의 속성 중 하나인 CurrentSample을 통해 현재 재생 중인 샘플을 받아올 수 있습니다. 이를 활용하여 실시간으로 바뀌는 파형을 만듭니다. 
+ 기타 변수 정의
```matlab
frame_len = 0.1;                        % 프레임길이: 0.1s
ylim = max(abs(audio));                 % 신호의 절대값의 최대값, time domain 파형의 y축 범위를 위함
half_frame = round(frame_len*fs/2);     % time domain 파형의 x 축 길이의 절반에 해당하는 샘플 크기
```
  - 조금 후에 다시 설명할 것이지만 timer을 사용하여 파형을 그리는 함수를 주기적으로 실행시킵니다. frame_len은 그 주기이자 화면에 표시할 프레임의 길이라고 보면 됩니다.
  - frame_len=0.1s 일 때 (frame_len\*fs)는 0.1초에 해당하는 오디오 신호의 길이라고 볼 수 있다.    
